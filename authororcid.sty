\NeedsTeXFormat{LaTeX2e}[1994/06/01]
\ProvidesPackage{authororcid}[2020/12/07 Author ORCID]

\RequirePackage{tikz}
\RequirePackage{xcolor}
\RequirePackage{enumitem}


\ProcessOptions\relax







%%% The ORCID green color
%
\definecolor{orcidgreen}{rgb}{0.65098041,0.80784315,0.22352941}


%%% The ORCID logo, produced via tikzpicture.
%%%
%%% This code has been translated from the SVG version hosted on Wikipedia.
%
\newcommand{\orcidlogo}[1]{%
\resizebox{#1}{!}{%
\begin{tikzpicture}[scale=0.010]%
\fill [orcidgreen]
  (256,128)
    .. controls (256,57.3)  and (198.7,0)   .. (128,0)
    .. controls (57.3,0)    and (0,57.3)    .. (0,128) 
    .. controls (0,198.7)   and (57.3,256)  .. (128,256)
    .. controls (198.7,256) and (256,198.7) .. (256,128)
    ;

\fill [white]
  (86.3,69.8)--(70.9,69.8)
             --(70.9,176.9)
             --(86.3,176.9)
             --(86.3,128.5)
             --(86.3,69.8)
  ;

\fill [white]
  (88.7,199.2)
    .. controls (88.7,193.7) and (84.2,189.1) .. (78.6,189.1)
    .. controls (73,189.1)   and (68.5,193.7) .. (68.5,199.2)
    .. controls (68.5,204.8) and (73,209.3)   .. (78.6,209.3)
    .. controls (84.2,209.3) and (88.7,204.7) .. (88.7,199.2)
  ;

\fill [white]
  (108.9,176.9)
  --(150.5,176.9)
  .. controls (190.1,176.9) and (207.5,148.6) ..(207.5,123.3)
  .. controls (207.5,95.8) and (186,69.7) .. (150.7,69.7)
  --(108.9,69.7)
  --(108.9,176.9)
  (124.3,83.6)
  --(148.8,83.6)
  .. controls (183.7,83.6)  and (191.7,110.1) .. (191.7,123.3)
  .. controls (191.7,144.8) and (178,163)     .. (148,163)
  --(124.3,163)
  --(124.3,83.6)
  ;
\end{tikzpicture}%
}%
}


\newlength{\orcidlogowidth}
\setlength{\orcidlogowidth}{8pt}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\newwrite\orcidoutput
\immediate\openout\orcidoutput=\jobname.looi


%%% redefining \@author@finish to close the \orcidoutput stream when we're done writing to file.
%
\makeatletter
\def\@author@finish{%
 \frontmatterverbose@sw{\typeout{\string\@author@finish}}{}%
 \move@AU\move@AF
 \@ifx{\AU@grp\@empty}{%
  \@ifx{\CO@grp\@empty}%
 }{%
  \false@sw
 }%
 {}{%
  \@ifx{\AF@grp\@empty}{%
   \begingroup
    \let\href\@secondoftwo
    \let\AU@opr\@secondofthree
    \let\CO@opr\@secondofthree
    \let\footnote\@gobble
    \@ifx{\CO@grp\@empty}{%
     \class@warn{Assuming \string\noaffiliation\space for authors}%
     \frontmatterverbose@sw{\say\AU@grp}%
    }{%
     \class@warn{Assuming \string\noaffiliation\space for collaboration}%
     \frontmatterverbose@sw{\say\CO@grp}{}%
    }%
   \endgroup
   \@affil@none\move@AF
  }{}%
 }%
 \move@AUAF%
 %
 %%% new code:
 %
 \immediate\closeout\orcidoutput%
}%
\makeatother

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\makeatletter
\newcommand{\@format@export@orcid}[2]{%
  \@backslashchar item %
  #1: %name
  \@backslashchar href{https://orcid.org/#2}{#2}
  }
%
\def\@export@orcid#1{%
  \immediate\write\orcidoutput{#1}%
  }
\makeatother


\makeatletter
\newcommand*\orcid[1]{\begingroup\@orcid@def{#1}}%
\def\@orcid@def#1{%
 \endgroup%
% \show\@author
 \@author@add@orcid{#1}
}%
\makeatother


\makeatletter
\def\@author@add@orcid@#1#2#3{%
  %
  \@export@orcid{\@format@export@orcid{#1}{#3}}
  %
  \def\@author{{%
    #1%
    \hspace{0.5\orcidlogowidth}%
    \href{https://orcid.org/#3}{\orcidlogo{\orcidlogowidth}}%
    }{#2}}%
}%
\def\@author@add@orcid{\expandafter\@author@add@orcid@\@author}%
\makeatother


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\makeatletter
\AtBeginDocument{
\@ifpackageloaded{hyperref}{%
  \def\orcididsectiontitle{ORCID \texorpdfstring{\lowercase{i}D\lowercase{s}}{iDs}}
  }{
  \def\orcididsectiontitle{ORCID \lowercase{i}D\lowercase{s}}
  }
}
\makeatother


\newcommand{\listoforcidids}{
  \section*{\orcididsectiontitle}
  \begin{itemize}[
    itemsep=-1mm,
    leftmargin=\dimexpr0.3cm+\labelsep\relax,
    label={\smash{\orcidlogo{8pt}}}
    ]
  \input{\jobname.looi}
  \end{itemize}
}





\endinput



















